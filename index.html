<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>What's Your Startup Equity Worth?</title>
  <meta name="description" content="Calculate the future value of your startup equity in seconds. See how dilution, funding rounds, and exit scenarios impact your take-home pay."/>
  <meta name="theme-color" content="#0b0f14"/>

  <!-- Open Graph / Social Media Meta Tags -->
  <meta property="og:title" content="What's Your Startup Equity Worth?" />
  <meta property="og:description" content="Calculate the future value of your startup equity in seconds. See how dilution, funding rounds, and exit scenarios impact your take-home pay." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://startupoffer.vercel.app/" />
  <meta property="og:image" content="https://images.unsplash.com/photo-1499346030926-9a72daac6c63?q=80&w=1200&auto=format&fit=crop&h=630" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="What's Your Startup Equity Worth?" />
  <meta name="twitter:description" content="Calculate the future value of your startup equity in seconds. See how dilution, funding rounds, and exit scenarios impact your take-home pay." />
  <meta name="twitter:image" content="https://images.unsplash.com/photo-1499346030926-9a72daac6c63?q=80&w=1200&auto=format&fit=crop&h=630" />

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    html{scroll-behavior:smooth} body{font-family:'Inter',sans-serif}
    .pill{border-radius:9999px;border:1px solid rgba(255,255,255,.15);background:rgba(0,0,0,.3);padding:.65rem 1.1rem;font-size:.9375rem;color:rgba(255,255,255,.8);transition:all .2s;cursor:pointer; outline: none; min-height: 44px;}
    .pill:hover{border-color:rgba(110,231,183,.6);color:#fff}
    .pill:focus-visible { box-shadow: 0 0 0 2px #0b0f14, 0 0 0 4px #6ee7b7; }
    .pill.is-active{
        background-color: #34d399; /* emerald-400 */
        border-color: #34d399;
        color: #0b0f14;
        font-weight: 600;
    }
    .pill.is-active:hover {
        background-color: #10b981; /* emerald-500 */
        border-color: #10b981;
    }
    .glass-card{-webkit-backdrop-filter:blur(24px);backdrop-filter:blur(24px)}
    .glass-card::before,
    .glass-card::after { pointer-events: none; }
    .num-cell{white-space:nowrap}
    #advancedSection { transition: all 0.3s ease-in-out; }
    .offer-input { min-height: 48px; }
    
    @media (max-width: 640px) {
      .glass-card { margin: 0 -1rem; border-radius: 1.5rem; }
      #calculator { padding-bottom: 3rem; }
      .result-card { padding: 1rem !important; }
      h1 { font-size: 2.25rem !important; line-height: 1.2; }
      .pill { padding: .7rem 1rem; font-size: .875rem; }
      table { font-size: .8125rem; }
      #futureValue { font-size: 2.5rem !important; }
    }
  </style>
</head>
<body class="min-h-screen bg-[#0b0f14] text-white">
  <!-- Background Image & Overlays -->
  <img src="https://images.unsplash.com/photo-1499346030926-9a72daac6c63?q=80&w=2400&auto=format&fit=crop" alt="" class="fixed inset-0 h-full w-full object-cover -z-10">
  <div class="fixed inset-0 bg-[radial-gradient(70%_120%_at_50%_0%,rgba(0,0,0,.65),rgba(11,15,20,.92))] pointer-events-none -z-10"></div>
  <div class="fixed inset-0 [box-shadow:inset_0_-120px_160px_-80px_rgba(11,15,20,.9)] pointer-events-none -z-10"></div>
  
  <!-- Hero -->
  <section class="relative h-[52vh] min-h-[520px] w-full flex items-center justify-center pt-16">
    <div class="mx-auto max-w-6xl w-full px-4 sm:px-6">
      <div class="max-w-3xl">
        <h1 class="text-4xl sm:text-5xl md:text-6xl font-extrabold leading-tight tracking-tight">Analyze Your <span class="bg-gradient-to-r from-emerald-400 to-lime-300 bg-clip-text text-transparent">Startup Offer</span></h1>
        <p class="mt-4 text-lg md:text-xl text-white/80">See the real value of your salary and equity across future rounds and potential exits.</p>
        <div class="mt-6 flex gap-3">
          <a href="#calculator" class="rounded-full bg-white text-black px-5 py-2.5 text-sm font-semibold hover:bg-white/90 transition-colors">Start Calculating</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Calculator -->
  <main id="calculator" class="relative -mt-24 pb-20">
    <div class="mx-auto max-w-5xl px-4">
      <div class="glass-card rounded-3xl relative z-10 bg-white/[0.06] bg-gradient-to-b from-white/[0.08] to-white/[0.02] shadow-[0_10px_40px_-10px_rgba(0,0,0,.6)]
                  before:absolute before:inset-0 before:rounded-3xl before:p-[1px] before:[background:linear-gradient(180deg,rgba(255,255,255,.25),rgba(255,255,255,.06))]
                  before:[-webkit-mask:linear-gradient(#000_0_0)_content-box,linear-gradient(#000_0_0)] before:[-webkit-mask-composite:xor] before:mask-composite:exclude
                  after:absolute after:inset-0 after:rounded-[calc(1.5rem-1px)] after:ring-1 after:ring-white/10">
        <div class="p-4 sm:p-6 md:p-10">
          <!-- Simple Inputs -->
          <div class="space-y-6">
            <div class="grid md:grid-cols-3 gap-4 md:gap-6">
              <div>
                <label class="block text-sm font-medium uppercase tracking-wider text-white/60">Salary ($)</label>
                <input id="salary" type="text"
                  class="mt-2 w-full rounded-xl border border-white/15 bg-black/30 px-4 py-3 text-base text-white placeholder:text-white/40 focus:border-emerald-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-300/40 offer-input"
                  value="120,000" placeholder="120,000">
              </div>
              <div>
                <label class="block text-sm font-medium uppercase tracking-wider text-white/60">Equity Grant (%)</label>
                <div class="relative mt-2">
                  <input id="yourOwnership" type="text"
                    class="w-full rounded-xl border border-white/15 bg-black/30 px-4 py-3 pr-10 text-base text-white placeholder:text-white/40 focus:border-emerald-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-300/40 offer-input"
                    value="0.10" inputmode="decimal" aria-describedby="equity-hint">
                  <span class="pointer-events-none absolute inset-y-0 right-3 flex items-center text-white/50">%</span>
                </div>
                <p id="equity-hint" class="mt-1 text-[11px] text-white/50">Tip: 0.25 = 0.25%</p>
              </div>
              <div>
                <label class="block text-sm font-medium uppercase tracking-wider text-white/60">Last Company Valuation ($)</label>
                <input id="companyValuation" type="text"
                  class="mt-2 w-full rounded-xl border border-white/15 bg-black/30 px-4 py-3 text-base text-white placeholder:text-white/40 focus:border-emerald-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-300/40 offer-input"
                  value="25,000,000">
              </div>
            </div>
            <div>
              <label class="block text-sm font-medium uppercase tracking-wider text-white/60">Potential Exit Valuation ($)</label>
              <input id="exitValuation" type="text" class="mt-2 w-full rounded-xl border border-white/15 bg-black/30 px-4 py-3 text-base text-white offer-input" value="1,000,000,000">
            </div>
            <div>
              <span id="stage-label" class="block text-sm font-medium uppercase tracking-wider text-white/60 mb-2">Last Financing Stage</span>
              <div id="stagePills" role="group" aria-labelledby="stage-label" class="flex flex-wrap gap-2">
                <button type="button" data-value="pre-seed"  class="pill" aria-pressed="false">Pre-Seed</button>
                <button type="button" data-value="seed"      class="pill" aria-pressed="false">Seed</button>
                <button type="button" data-value="series-a"  class="pill is-active" aria-pressed="true">Series A</button>
                <button type="button" data-value="series-b"  class="pill" aria-pressed="false">Series B</button>
                <button type="button" data-value="series-c"  class="pill" aria-pressed="false">Series C</button>
                <button type="button" data-value="series-d"  class="pill" aria-pressed="false">Series D+</button>
              </div>
              <input type="hidden" id="fundingStage" value="series-a">
            </div>
          </div>
          
          <!-- Primary Results (always visible) -->
          <div class="my-8 h-px w-full bg-gradient-to-r from-transparent via-white/20 to-transparent"></div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
            <div class="space-y-2 rounded-2xl border border-white/15 bg-white/[0.04] p-5 result-card">
              <div class="text-sm uppercase tracking-wider text-white/60">Total 1st Year Comp</div>
              <div id="totalComp" class="text-3xl font-bold" aria-live="polite">$145,000</div>
              <div class="text-xs text-white/50">Salary + value of <strong>vested</strong> equity today</div>
              <div class="text-xs text-white/50" id="vestedNote"></div>
            </div>
            <div class="space-y-2 rounded-2xl border border-white/15 bg-white/[0.04] p-5 result-card">
              <div class="flex items-baseline justify-between">
                <span class="text-sm uppercase tracking-wider text-white/60">Est. Ownership at Exit</span>
                <span id="dilutedOwnership" class="text-xl font-semibold">0.06%</span>
              </div>
              <div class="text-sm uppercase tracking-wider text-white/60 mt-3">Potential Equity Value</div>
              <div id="futureValue" class="bg-gradient-to-r from-emerald-300 to-lime-300 bg-clip-text text-transparent text-4xl font-extrabold tracking-tight" aria-live="polite">$640,000</div>
              <div id="afterTax" class="text-sm text-white/70" aria-live="polite"></div>
              <div id="presentValue" class="text-sm text-white/70" aria-live="polite"></div>
            </div>
             <div class="md:col-span-2 space-y-3 rounded-2xl border border-white/15 bg-white/[0.04] p-4 md:p-5 overflow-x-auto result-card">
              <div class="text-sm uppercase tracking-wider text-white/60">Exit Scenarios</div>
              <table class="w-full text-sm">
                <thead class="text-white/60 border-b border-white/20">
                  <tr><th class="text-left font-medium py-2 pr-2">Case</th><th class="text-right font-medium py-2 px-2">Exit</th><th class="text-right font-medium py-2 pl-2">Your Take-Home</th></tr>
                </thead>
                <tbody id="scenarioBody"></tbody>
              </table>
            </div>
          </div>

          <!-- Advanced Toggle -->
          <div class="text-center pt-8">
            <button id="toggleAdvanced" type="button" class="group text-emerald-300 hover:text-emerald-200 text-sm font-semibold flex items-center gap-2 mx-auto">
              <span id="toggleText">Show Advanced Options</span>
              <svg id="toggleIcon" class="w-4 h-4 transform transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>
            </button>
          </div>

          <!-- Advanced Section (hidden by default) -->
          <div id="advancedSection" class="hidden space-y-8 border-t border-white/10 pt-8 mt-8">
              <!-- Valuation basis toggle -->
              <div class="text-sm text-white/80" id="valMode">
                  <label class="inline-flex items-center gap-2 mr-6">
                      <input type="radio" name="valBasis" value="409a" checked class="accent-emerald-400"> Use 409A (recommended)
                  </label>
                  <label class="inline-flex items-center gap-2">
                      <input type="radio" name="valBasis" value="post" class="accent-emerald-400"> Use last round post-money
                  </label>
              </div>
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
                <div>
                  <label class="block text-sm font-medium uppercase tracking-wider text-white/60">Vesting (years)</label>
                  <input id="vestingYears" type="text" class="mt-2 w-full rounded-xl border border-white/15 bg-black/30 px-4 py-3 text-base text-white offer-input" value="4">
                </div>
                <div>
                  <label class="block text-sm font-medium uppercase tracking-wider text-white/60">Cliff (months)</label>
                  <input id="cliffMonths" type="text" class="mt-2 w-full rounded-xl border border-white/15 bg-black/30 px-4 py-3 text-base text-white offer-input" value="12">
                </div>
                <div>
                  <label class="block text-sm font-medium uppercase tracking-wider text-white/60">Months Served</label>
                  <input id="monthsServed" type="text" class="mt-2 w-full rounded-xl border border-white/15 bg-black/30 px-4 py-3 text-base text-white offer-input" value="0">
                </div>
                <div>
                  <label class="block text-sm font-medium uppercase tracking-wider text-white/60">Fully Diluted Shares (optional)</label>
                  <input id="fdShares" type="text" class="mt-2 w-full rounded-xl border border-white/15 bg-black/30 px-4 py-3 text-base text-white offer-input" placeholder="e.g. 50,000,000">
                </div>
              </div>
              <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
                <div>
                  <label class="block text-sm font-medium uppercase tracking-wider text-white/60">409A FMV ($/share)</label>
                  <input id="fmv" type="text" class="mt-2 w-full rounded-xl border border-white/15 bg-black/30 px-4 py-3 text-base text-white offer-input" placeholder="e.g. 1.25">
                </div>
                <div>
                  <label class="block text-sm font-medium uppercase tracking-wider text-white/60">Strike Price ($/share)</label>
                  <input id="strike" type="text" class="mt-2 w-full rounded-xl border border-white/15 bg-black/30 px-4 py-3 text-base text-white offer-input" placeholder="e.g. 0.20">
                </div>
                <div>
                  <label class="block text-sm font-medium uppercase tracking-wider text-white/60">Tax Estimate (%)</label>
                  <input id="taxPct" type="text" class="mt-2 w-full rounded-xl border border-white/15 bg-black/30 px-4 py-3 text-base text-white offer-input" value="0">
                </div>
                 <div>
                    <label class="block text-sm font-medium uppercase tracking-wider text-white/60">Pref Stack ($, 1× non-participating)</label>
                    <input id="prefStack" type="text" class="mt-2 w-full rounded-xl border border-white/15 bg-black/30 px-4 py-3 text-base text-white offer-input" placeholder="e.g. 50,000,000">
                </div>
              </div>
              <div class="grid md:grid-cols-2 gap-4 md:gap-6">
                  <label class="flex flex-col">
                    <span class="text-sm font-medium uppercase tracking-wider text-white/60">Years to Exit</span>
                    <input id="yearsToExit" class="offer-input mt-2 rounded-xl border border-white/15 bg-black/30 px-4 py-3 text-white" value="5">
                  </label>
                  <label class="flex flex-col">
                    <span class="text-sm font-medium uppercase tracking-wider text-white/60">Discount Rate %</span>
                    <input id="discRate" class="offer-input mt-2 rounded-xl border border-white/15 bg-black/30 px-4 py-3 text-white" value="12">
                  </label>
              </div>
              <div class="rounded-2xl border border-white/15 bg-white/[0.04] p-5">
                <div class="text-sm font-medium uppercase tracking-wider text-white/60 mb-2">Editable Dilution Assumptions</div>
                <div class="grid sm:grid-cols-5 gap-3 text-sm">
                  <label class="flex flex-col">Seed % <input id="dSeed" class="offer-input rounded-md bg-black/30 border border-white/15 px-3 py-2" value="22"></label>
                  <label class="flex flex-col">A % <input id="dA" class="offer-input rounded-md bg-black/30 border border-white/15 px-3 py-2" value="20"></label>
                  <label class="flex flex-col">B % <input id="dB" class="offer-input rounded-md bg-black/30 border border-white/15 px-3 py-2" value="18"></label>
                  <label class="flex flex-col">C % <input id="dC" class="offer-input rounded-md bg-black/30 border border-white/15 px-3 py-2" value="15"></label>
                  <label class="flex flex-col">Pool top-up % <input id="poolTopUp" class="offer-input rounded-md bg-black/30 border border-white/15 px-3 py-2" value="0"></label>
                </div>
                <p class="mt-2 text-xs text-white/60">Top-up is added to each applicable round as extra dilution.</p>
              </div>
              <div class="space-y-4">
                 <div id="exerciseCost" class="text-sm text-white/70" aria-live="polite"></div>
                 <div id="dilutionBand" class="text-sm text-white/70 mt-1"></div>
              </div>
              <div class="rounded-2xl border border-white/15 bg-white/[0.04] p-5">
                <div class="text-sm font-medium uppercase tracking-wider text-white/60 mb-2">Vesting Timeline (current value basis)</div>
                <table class="w-full text-sm">
                  <thead class="text-white/60">
                    <tr><th class="text-left font-medium py-1">Month</th><th class="text-right font-medium py-1">Vested %</th><th class="text-right font-medium py-1">Current $</th></tr>
                  </thead>
                  <tbody id="vestingRows"></tbody>
                </table>
              </div>
          </div>

          <p class="mt-8 text-[12px] leading-relaxed text-white/60">
            <strong>Notes:</strong> Dilution is an estimate; option pool refreshes/terms vary. Calculator assumes 1× non-participating prefs; ignores participating prefs and multiples &gt;1×. Tax treatment differs by ISO/NSO, holding periods, AMT, QSBS, and jurisdiction.
          </p>
        </div>
      </div>
    </div>
  </main>

  <footer class="mt-16 pb-10 text-center text-white/40 text-xs">
    <div class="flex flex-col items-center gap-3">
        <div class="flex flex-col md:flex-row items-center gap-3 md:gap-x-4 text-base md:text-sm text-white/70">
             <a href="https://www.spicecapital.xyz/" target="_blank" rel="noopener" class="hover:text-white transition-colors">
                Created by Spice Capital
            </a>
            <span class="hidden md:inline text-white/30">|</span>
            <a href="mailto:info@spicecap.xyz" class="hover:text-white transition-colors">Learn More</a>
        </div>
        <div class="flex items-center gap-4">
            <a href="https://www.instagram.com/spice_cap/" target="_blank" rel="noopener" class="text-white/40 hover:text-white transition-colors" aria-label="Instagram">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M12.315 2c2.43 0 2.784.013 3.808.06 1.064.049 1.791.218 2.427.465a4.902 4.902 0 011.772 1.153 4.902 4.902 0 011.153 1.772c.247.636.416 1.363.465 2.427.048 1.024.06 1.378.06 3.808s-.012 2.784-.06 3.808c-.049 1.064-.218 1.791-.465 2.427a4.902 4.902 0 01-1.153 1.772 4.902 4.902 0 01-1.772 1.153c-.636.247-1.363.416-2.427.465-1.024.048-1.378.06-3.808.06s-2.784-.012-3.808-.06c-1.064-.049-1.791-.218-2.427-.465a4.902 4.902 0 01-1.772-1.153 4.902 4.902 0 01-1.153-1.772c-.247-.636-.416-1.363-.465-2.427-.048-1.024-.06-1.378-.06-3.808s.012-2.784.06-3.808c.049-1.064.218-1.791.465-2.427a4.902 4.902 0 011.153-1.772A4.902 4.902 0 016.08 2.525c.636-.247 1.363-.416 2.427-.465C9.53 2.013 9.884 2 12.315 2zM12 7.027a5.307 5.307 0 110 10.614 5.307 5.307 0 010-10.614zM12 15.362a3.362 3.362 0 100-6.724 3.362 3.362 0 000 6.724zM16.812 6.162a1.15 1.15 0 100 2.3 1.15 1.15 0 000-2.3z" clip-rule="evenodd" /></svg>
            </a>
            <a href="https://www.tiktok.com/@spicecapital" target="_blank" rel="noopener" class="text-white/40 hover:text-white transition-colors" aria-label="TikTok">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-2.43.05-4.86-.95-6.43-2.8-1.58-1.85-2.2-4.45-1.7-7.17.45-2.45 1.97-4.59 4.12-5.74 1.5-.81 3.24-1.14 5.01-1.07.12 1.54-.31 3.08-1.42 4.15-1.13 1.09-2.71 1.57-4.24 1.63-.5.02-1-.01-1.49-.09-.34-.05-.68-.14-.99-.28-.31-.14-.59-.33-.81-.56-.6-.61-.9-1.43-.8-2.31.02-1.03.53-2.02 1.34-2.66.83-.65 1.9-.92 2.95-.81.65.06 1.3.16 1.93.3.14.03.27.07.41.1.02-1.55.02-3.1-.01-4.65z"/></svg>
            </a>
            <a href="https://www.linkedin.com/company/spicecapital/?viewAsMember=true" target="_blank" rel="noopener" class="text-white/40 hover:text-white transition-colors" aria-label="LinkedIn">
                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/></svg>
            </a>
        </div>
    </div>
</footer>

  <script>
    (function() {
        // ============== Elements ==============
        const salaryEl = document.getElementById('salary');
        const ownEl = document.getElementById('yourOwnership');
        const companyValEl = document.getElementById('companyValuation');
        const fdSharesEl = document.getElementById('fdShares');
        const fmvEl = document.getElementById('fmv');
        const strikeEl = document.getElementById('strike');
        const taxEl = document.getElementById('taxPct');
        const exitEl = document.getElementById('exitValuation');
        const prefEl = document.getElementById('prefStack');
        const stagePills = document.getElementById('stagePills');
        const fundingStageEl = document.getElementById('fundingStage');
        const vestYearsEl = document.getElementById('vestingYears');
        const cliffEl = document.getElementById('cliffMonths');
        const servedEl = document.getElementById('monthsServed');
        const totalCompEl = document.getElementById('totalComp');
        const dilutedEl = document.getElementById('dilutedOwnership');
        const futureEl = document.getElementById('futureValue');
        const afterTaxEl = document.getElementById('afterTax');
        const presentValueEl = document.getElementById('presentValue');
        const exerciseEl = document.getElementById('exerciseCost');
        const vestedNoteEl = document.getElementById('vestedNote');
        const scenarioBody = document.getElementById('scenarioBody');
        const vestBody = document.getElementById('vestingRows');
        const dilutionBandEl = document.getElementById('dilutionBand');
        const dSeedEl = document.getElementById('dSeed');
        const dAEl    = document.getElementById('dA');
        const dBEl    = document.getElementById('dB');
        const dCEl    = document.getElementById('dC');
        const poolTopUpEl = document.getElementById('poolTopUp');
        const yearsToExitEl = document.getElementById('yearsToExit');
        const discRateEl    = document.getElementById('discRate');
        const toggleBtn = document.getElementById('toggleAdvanced');
        const toggleText = document.getElementById('toggleText');
        const toggleIcon = document.getElementById('toggleIcon');
        const valMode = document.getElementById('valMode');
        const advancedSection = document.getElementById('advancedSection');

        // ============== Helpers ==============
        const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;

        function parseNumber(str){ if(typeof str!=='string') str=String(str); return parseFloat(str.replace(/,/g,''))||0; }
        function fmtCur(n){ return new Intl.NumberFormat('en-US',{style:'currency',currency:'USD',minimumFractionDigits:0,maximumFractionDigits:0}).format(n); }
        function fmtShortCur(n) {
          if (n >= 1e9) return '$' + (n / 1e9).toFixed(1).replace(/\.0$/, '') + 'B';
          if (n >= 1e6) return '$' + (n / 1e6).toFixed(1).replace(/\.0$/, '') + 'M';
          if (n >= 1e3) return '$' + (n / 1e3).toFixed(1).replace(/\.0$/, '') + 'K';
          return fmtCur(n);
        }
        function fmtPct(n){ return `${n.toFixed(2)}%`; }
        function fmtInt(n){ return new Intl.NumberFormat('en-US').format(Math.round(n)); }
        function clampPercent(p){ return Math.min(100, Math.max(0, p)); }

        function vestedFraction(years, cliffMonths, servedMonths){
            const totalMonths = Math.max(1, Math.round(years*12));
            if (servedMonths < cliffMonths) return 0;
            return Math.min(1, servedMonths/totalMonths);
        }

        function animate(el, to, fmt){ if(prefersReduced || !el){ if(el) el.textContent = fmt(to); if(el) el.dataset.raw=to; return; }
            const dur=600, start=performance.now(); const from=parseFloat(el.dataset?.raw||'0')||0;
            const ease=t=>1-Math.pow(1-t,3);
            const step=now=>{ const p=Math.min(1,(now-start)/dur); const v=from+(to-from)*ease(p); el.textContent=fmt(v); if(p<1) requestAnimationFrame(step); else el.dataset.raw=to; };
            requestAnimationFrame(step);
        }

        function currencyInput(el){
            if (el.setSelectionRange) {
                let cursor=el.selectionStart, orig=el.value.length;
                let v=el.value.replace(/,/g,''); if(/[^0-9.]/.test(v)) v=v.replace(/[^0-9.]/g,'');
                const num=parseNumber(v); el.value = el.value!=='' ? fmtInt(num) : '';
                const nlen=el.value.length; if(nlen>orig) cursor+= (nlen-orig); el.setSelectionRange(cursor,cursor);
            }
        }

        function roundDilution(stageKey){
            const order = {
                'pre-seed': ['seed','a','b','c'], 'seed': ['a','b','c'], 'series-a': ['b','c'],
                'series-b': ['c'], 'series-c': ['c'], 'series-d': []
            }[stageKey] || [];
            const pool = clampPercent(parseNumber(poolTopUpEl.value))/100;
            const map = {
                seed: clampPercent(parseNumber(dSeedEl.value))/100 + pool,
                a:    clampPercent(parseNumber(dAEl.value))/100    + pool,
                b:    clampPercent(parseNumber(dBEl.value))/100    + pool,
                c:    clampPercent(parseNumber(dCEl.value))/100    + pool,
            };
            return order.map(k => Math.min(0.99, map[k] || 0));
        }

        // ============== Calculation ==============
        let valuationBasis = '409a';

        function calculate(){
            const salary = parseNumber(salaryEl.value);
            const grantPct = clampPercent(parseNumber(ownEl.value));
            const companyVal = parseNumber(companyValEl.value);
            const fdShares = parseNumber(fdSharesEl.value);
            const fmv = parseNumber(fmvEl.value);
            const strike = parseNumber(strikeEl.value);
            const taxPct = clampPercent(parseNumber(taxEl.value));
            const exitVal = parseNumber(exitEl.value);
            const prefStack = parseNumber(prefEl.value);
            const stageKey = fundingStageEl.value;
            const vestYears = parseNumber(vestYearsEl.value);
            const cliffMonths = parseNumber(cliffEl.value);
            const servedMonths = parseNumber(servedEl.value);
            const grantFraction = grantPct/100;
            const vestFrac = vestedFraction(vestYears, cliffMonths, servedMonths);
            const grantedShares = fdShares ? grantFraction * fdShares : 0;
            const vestedShares = grantedShares * vestFrac;
            let currentEquityValue;
            if (valuationBasis === '409a' && fmv > 0 && vestedShares > 0) { currentEquityValue = fmv * vestedShares; } 
            else { currentEquityValue = companyVal * grantFraction * vestFrac; }
            const totalComp = salary + currentEquityValue;
            const dilutions = roundDilution(stageKey);
            const dilutedOwnership = grantFraction * dilutions.reduce((acc, d) => acc*(1 - d), 1);
            const commonPool = Math.max(0, exitVal - (prefStack || 0));
            const yourGross = commonPool * dilutedOwnership;
            const exerciseCost = (vestedShares && strike) ? (vestedShares * strike) : 0;
            const netBeforeTax = Math.max(0, yourGross - exerciseCost);
            const afterTax = netBeforeTax * (1 - taxPct/100);
            const yearsToExit = Math.max(0, parseNumber(yearsToExitEl.value));
            const discRate = clampPercent(parseNumber(discRateEl.value))/100;
            const pv = (yearsToExit > 0 && discRate > 0) ? afterTax / Math.pow(1 + discRate, yearsToExit) : null;
            animate(totalCompEl, totalComp, fmtCur);
            dilutedEl.textContent = fmtPct(dilutedOwnership*100);
            animate(futureEl, yourGross, fmtCur);
            afterTaxEl.textContent = taxPct ? `After tax: ${fmtCur(afterTax)}` : '';
            presentValueEl.textContent = (pv!=null) ? `Present value (~${yearsToExit} yrs @ ${(discRate*100).toFixed(0)}%): ${fmtCur(pv)}` : '';
            exerciseEl.textContent = exerciseCost ? `Exercise cost (vested): ${fmtCur(exerciseCost)}` : '';
            vestedNoteEl.textContent = (vestFrac<1) ? `Vested ${fmtPct(vestFrac*100)} of grant (${fdShares? fmtInt(vestedShares)+' sh' : fmtPct(grantPct*vestFrac)})` : 'Fully vested grant';

            const exits = [
                {label:'Bear', val: Math.max(0, exitVal*0.5)}, {label:'Base',  val: exitVal}, {label:'Best',  val: exitVal*1.5}
            ];
            scenarioBody.innerHTML = exits.map(s=>{
                const pool = Math.max(0, s.val - (prefStack||0));
                const gross = pool * dilutedOwnership;
                const net = Math.max(0, gross - exerciseCost);
                const at = taxPct ? net*(1-taxPct/100) : net;
                return `<tr class="border-b border-white/10 last:border-b-0">
                    <td class="py-3 pr-2">${s.label}</td>
                    <td class="py-3 text-right num-cell">${fmtShortCur(s.val)}</td>
                    <td class="py-3 text-right num-cell text-base font-bold text-white">${fmtShortCur(at)}</td>
                </tr>`;
            }).join('');

            if (dilutions.length){
                const avg = dilutions.reduce((a,b)=>a+b,0)/dilutions.length;
                const low = Math.max(0, avg - 0.05);
                const hi  = Math.min(0.9, avg + 0.05);
                const ownLow = grantFraction * Math.pow(1 - low, dilutions.length);
                const ownHi  = grantFraction * Math.pow(1 - hi,  dilutions.length);
                dilutionBandEl.textContent = `Sensitivity: if avg dilution were ${fmtPct((low)*100)}–${fmtPct((hi)*100)} per round, exit ownership ~ ${fmtPct(ownHi*100)}–${fmtPct(ownLow*100)}.`;
            } else { dilutionBandEl.textContent = ''; }

            const checkpoints=[12,24,36,48];
            vestBody.innerHTML = checkpoints.map(m=>{
                const vf = vestedFraction(vestYears, cliffMonths, m);
                const vSh = grantedShares*vf;
                const cur = (valuationBasis==='409a' && fmv>0 && vSh>0) ? (fmv*vSh) : (companyVal*grantFraction*vf);
                return `<tr>
                    <td class="py-1">${m} mo</td>
                    <td class="py-1 text-right num-cell">${fmtPct(vf*100)}</td>
                    <td class="py-1 text-right num-cell">${fmtCur(cur)}</td>
                </tr>`;
            }).join('');
        }

        // ============== Wiring ==============
        valMode.addEventListener('change', (e)=>{
            const r = e.target.closest('input[name="valBasis"]');
            if (r) { valuationBasis = r.value; calculate(); }
        });

        toggleBtn.addEventListener('click', () => {
            const isHidden = advancedSection.classList.toggle('hidden');
            toggleText.textContent = isHidden ? 'Show Advanced Options' : 'Hide Advanced Options';
            toggleIcon.style.transform = isHidden ? 'rotate(0deg)' : 'rotate(180deg)';
        });

        document.querySelectorAll('.offer-input').forEach(input=>{
            input.addEventListener('input', (e)=>{
                const el=e.target;
                if(['yourOwnership','vestingYears','cliffMonths','monthsServed','fmv','strike','taxPct','dSeed','dA','dB','dC','poolTopUp','yearsToExit','discRate'].includes(el.id)){
                    calculate(); return;
                }
                currencyInput(el); calculate();
            });
            input.addEventListener('focus', (e)=>{
                const el=e.target;
                if(['yourOwnership','vestingYears','cliffMonths','monthsServed','fmv','strike','taxPct','dSeed','dA','dB','dC','poolTopUp','yearsToExit','discRate'].includes(el.id)) return;
                el.value=String(parseNumber(el.value));
            });
            input.addEventListener('blur', (e)=>{
                const el=e.target;
                if(['yourOwnership','vestingYears','cliffMonths','monthsServed','fmv','strike','taxPct','dSeed','dA','dB','dC','poolTopUp','yearsToExit','discRate'].includes(el.id)) return;
                if(el.value) el.value=fmtInt(parseNumber(el.value));
            });
        });

        stagePills.addEventListener('click', e=>{
            const btn=e.target.closest('button[data-value]'); if(!btn) return;
            stagePills.querySelectorAll('.pill').forEach(b=>{ b.classList.remove('is-active'); b.setAttribute('aria-pressed','false'); });
            btn.classList.add('is-active'); btn.setAttribute('aria-pressed','true');
            fundingStageEl.value=btn.dataset.value; calculate();
        });

        document.querySelectorAll('input.offer-input').forEach(input=>{
            if(['yourOwnership','vestingYears','cliffMonths','monthsServed','fmv','strike','taxPct','dSeed','dA','dB','dC','poolTopUp','yearsToExit','discRate'].includes(input.id)) return;
            if(input.value) input.value = fmtInt(parseNumber(input.value));
        });
        calculate();
    })();
  </script>
</body>
</html>

